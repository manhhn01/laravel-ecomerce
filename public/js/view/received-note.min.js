/******/ (() => { // webpackBootstrap
var __webpack_exports__ = {};
/*!********************************************!*\
  !*** ./resources/js/view/received-note.js ***!
  \********************************************/
$(function () {
  $('#printBtn').on('click', function () {
    printNote();
  }); //input product id event

  $(".product-search-input").on("input", debounce(function () {
    getProduct($(this).val());
  }, 500)); //button add product event

  $(".add-order-product-btn").on("click", function () {
    var idSku = $(".product-search-input").val();
    addProduct(idSku);
  }); //table input event

  $('#productsTable input').on('input', function () {
    if ($(this).val() !== '') {
      updatePrice();
    }
  });
});
/* end ready */
//get product preview

var getProduct = function getProduct(idSku) {
  if (idSku) {
    $.ajax({
      method: "post",
      url: "/product/ajax",
      data: {
        id_sku: idSku
      },
      beforeSend: function beforeSend() {
        $("#productPreview").empty();
        $("#productLoad").removeClass("d-none").addClass("d-flex justify-content-center");
      },
      complete: function complete() {
        $("#productLoad").addClass("d-none").removeClass("d-flex justify-content-center");
      },
      success: function success(result) {
        var data = result.data;
        var error = result.error;

        if (data) {
          $("#productPreview").html("\n                    <div class=\"card product-preview-card\">\n                    <div class=\"card-body\">\n                    <p class=\"card-text\">Id: ".concat(data.product_id, "</p>\n                    <p class=\"card-text\">SKU: ").concat(data.sku, "</p>\n                    <h5 class=\"card-title\">").concat(data.product_name, "</h5>\n                    <p class=\"card-text text-danger\">").concat(data.price.toLocaleString("vi-VN"), " \u0111</p>\n                    <p class=\"card-text\">S\u1ED1 l\u01B0\u1EE3ng: ").concat(data.quantity, "</p>\n                    </div>\n                    </div>\n                "));
        } else if (error) {
          console.log(error.code, error.message);
        }
      }
    });
  } else {
    $("#productPreview").empty();
  }
}; //add product to table


var addProduct = function addProduct(idSku) {
  $.ajax({
    method: "post",
    url: "/product/ajax",
    data: {
      id_sku: idSku
    },
    success: function success(result) {
      var data = result.data,
          error = result.error;

      if (data) {
        if ($("#productsTable>tbody").find("[data-id=".concat(data.product_id, "]")).length !== 0) {
          alertMsg("Sản phẩm đã có trong phiếu");
        } else {
          var productRow = $("\n                        <tr data-id=".concat(data.product_id, ">\n                        <input type=\"hidden\" name=\"products[").concat(data.product_id, "][product_id]\" value=\"").concat(data.product_id, "\">\n                        <th scope=\"row\">\n                            ").concat(data.product_name, "\n                        </th>\n                        <td>\n                            ").concat(data.sku, "\n                        </td>\n                        <td>\n                            <input class=\"form-control\" type=\"number\" min=\"1\" max=\"30000\" name=\"products[").concat(data.product_id, "][quantity]\" value=\"1\" oninput=\"updatePrice()\">\n                        </td>\n                        <td>\n                            <input type=\"text\" class=\"form-control\" name=\"products[").concat(data.product_id, "][price]\" value=\"0\" maxlength=\"15\" oninput=\"updatePrice()\">\n                        </td>\n                        <td>\n                            <button type=\"button\" class=\"btn btn-danger delete-order-product-btn\" onclick=\"removeProduct(").concat(data.product_id, ")\">X\xF3a</button>\n                        </td>\n                        </tr>\n                        "));
          $("#productsTable>tbody>tr:last-child").before(productRow);
          updatePrice();
        }
      }

      if (error) {
        console.log(error.code, error.message);

        if (error.code === 404) {
          alertMsg("Không tìm thấy sản phẩm");
        }
      }
    }
  });
}; //add alert message


var alertMsg = function alertMsg(msg) {
  var alert = $("<div class=\"alert alert-danger\" id=\"orderListAlerts\" role=\"alert\">".concat(msg, "</div>"));
  $("#orderListAlerts").append(alert);
  setTimeout(function () {
    alert.remove();
  }, 2000);
}; //remove product from list


var removeProduct = function removeProduct(id) {
  $("[data-id=".concat(id, "]")).remove();
  updatePrice();
}; //update price


var updatePrice = function updatePrice() {
  var rows = $("#productsTable tr:not(:last-child)");
  var sum = 0;
  rows.each(function (index, row) {
    sum += $(row).find('input[name*="price"]').val() * $(row).find('input[name*="quantity"]').val();
  });
  $("#totalPrice").text(sum.toLocaleString("vi-VN") + " đ");
};

var printNote = function printNote() {
  window.print();
};
/******/ })()
;