/******/ (() => { // webpackBootstrap
var __webpack_exports__ = {};
/*!**************************************!*\
  !*** ./resources/js/view/product.js ***!
  \**************************************/
function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

$(function () {
  var _$$selectize, _$$selectize2;

  /* SLUG FIELD */
  $("#name").on("input", function () {
    $("#slug").val(slugnify(this.value));
  });
  /* SELECTIZE */

  $(".selectize").selectize();
  $("#brandSelect").selectize((_$$selectize = {
    create: true,
    placeholder: "Chọn thương hiệu ..."
  }, _defineProperty(_$$selectize, "create", function create(input) {
    return {
      value: input,
      text: input
    };
  }), _defineProperty(_$$selectize, "render", {
    option_create: function option_create(data, escape) {
      var addString = "Thêm thương hiệu";
      return '<div class="create">' + addString + " <strong>" + escape(data.input) + "</strong>&hellip;</div>";
    }
  }), _$$selectize));
  $("#categorySelect").selectize((_$$selectize2 = {
    create: true
  }, _defineProperty(_$$selectize2, "create", function create(input) {
    return {
      value: input,
      text: input
    };
  }), _defineProperty(_$$selectize2, "render", {
    option_create: function option_create(data, escape) {
      var addString = "Thêm danh mục";
      return '<div class="create">' + addString + " <strong>" + escape(data.input) + "</strong>&hellip;</div>";
    }
  }), _$$selectize2));
  /* CONFIRM DELETE */

  $(".delete-product").on("submit", function () {
    if (confirm("Bạn có chác chắn muốn xóa sản phẩm " + this.dataset.name + this.dataset.id)) {
      return true;
    }

    return false;
  });
  /* PREVIEW IMAGES */

  $(".preview-input").on("change", function () {
    previewImage(this);
  });
  $(".preview-input[multiple]").on("change", function () {
    previewProductImages(this);
  });
  /* CAROUSEL */

  $("#productSlide").carousel({
    pause: true,
    interval: false
  });
  /* VARIANT TABS */

  $(".nav-tabs>a").on("click", function () {
    $(this).addClass("active").siblings().removeClass("active");
    var target = $(this).data("target");
    $("#" + target).addClass("show active").fadeIn().siblings(".tab-pane").fadeOut().removeClass("show active");
  });
  $("#addVariant2").on("click", function () {
    $(this).hide();
    $("#variant1").after(
    /* html */
    "\n            <div class=\"mb-4\" id=\"variant2\">\n                <div class=\"variant-group form-group mb-2\">\n                    <label class=\"form-label required\" for=\"variant1\">Nh\xF3m ph\xE2n lo\u1EA1i 2</label>\n                    <input type=\"text\" class=\"form-control mb-2 variant-name\" name=\"variant2_group_name\" placeholder=\"T\xEAn nh\xF3m ph\xE2n lo\u1EA1i (VD: M\xE0u s\u1EAFc, k\xEDch c\u1EE1)\">\n                    <input type=\"text\" class=\"form-control mb-2 variant2-value infinite-input\" name=\"variant2_group_values[]\" placeholder=\"T\xEAn ph\xE2n lo\u1EA1i (VD: \u0110\u1ECF)\">\n                </div>\n                <button class=\"btn btn-danger\" type=\"button\" id=\"removeVariant2\">X\xF3a ph\xE2n lo\u1EA1i 2</button>\n            </div>\n            ");
    addUpdateTableListener();
    addInfiniteInputListener("#variant2 .infinite-input");
    addRemoveVariant2Listener("#removeVariant2");
  });
  $("#applyAllBtn").on("click", function () {
    var price = $("#priceAll").val();
    var quantity = $("#quantityAll").val();
    var sku = $("#skuAll").val();
    $(".v-price").val(price);
    $(".v-quantity").val(quantity);
    $(".v-sku").val(sku);
  });
  $("#productStoreForm").on("submit", function (e) {
    e.preventDefault();

    if ($("#multipleVariants.active").length !== 0) {
      $("#singleVariant input").prop("disabled", true);
    } else {
      $("#multipleVariants input").prop("disabled", true);
    }

    var form = new FormData($("#productStoreForm").get(0));
    $.ajax({
      url: FORM_POST,
      type: "POST",
      date: form,
      processData: false,
      contentType: false
    }); // TODO: ajax
  });
  addUpdateTableListener();
  addInfiniteInputListener(".infinite-input");
});
/* FUNCTIONS */

function slugnify(title) {
  slug = title.toLowerCase();
  slug = slug.replace(/á|à|ả|ạ|ã|ă|ắ|ằ|ẳ|ẵ|ặ|â|ấ|ầ|ẩ|ẫ|ậ/gi, "a");
  slug = slug.replace(/é|è|ẻ|ẽ|ẹ|ê|ế|ề|ể|ễ|ệ/gi, "e");
  slug = slug.replace(/i|í|ì|ỉ|ĩ|ị/gi, "i");
  slug = slug.replace(/ó|ò|ỏ|õ|ọ|ô|ố|ồ|ổ|ỗ|ộ|ơ|ớ|ờ|ở|ỡ|ợ/gi, "o");
  slug = slug.replace(/ú|ù|ủ|ũ|ụ|ư|ứ|ừ|ử|ữ|ự/gi, "u");
  slug = slug.replace(/ý|ỳ|ỷ|ỹ|ỵ/gi, "y");
  slug = slug.replace(/đ/gi, "d");
  slug = slug.replace(/\`|\~|\!|\@|\#|\||\$|\%|\^|\&|\*|\(|\)|\+|\=|\,|\.|\/|\?|\>|\<|\'|\"|\:|\;|_/gi, "");
  slug = slug.replace(/ /gi, "-"); //Phòng trường hợp người nhập vào quá nhiều ký tự trắng

  slug = slug.replace(/\-\-\-\-\-/gi, "-");
  slug = slug.replace(/\-\-\-\-/gi, "-");
  slug = slug.replace(/\-\-\-/gi, "-");
  slug = slug.replace(/\-\-/gi, "-");
  slug = slug.replace(/^\-|\-$/gi, "");
  return slug;
}

function previewImage(input) {
  var file = input.files[0];
  var fileReader = new FileReader();
  fileReader.addEventListener("load", function () {
    $(input).next(".preview-img-wrapper").removeClass("d-none").addClass("img-thumbnail").children("img").attr("src", fileReader.result);
  }, false);

  if (file) {
    fileReader.readAsDataURL(file);
  }
}

function previewProductImages(input) {
  var previewImgs = $(input).next(".preview-imgs");
  previewImgs.removeClass("d-none").empty();
  var files = Array.from(input.files);
  files.forEach(function (file) {
    var fileReader = new FileReader();
    fileReader.addEventListener("load", function () {
      previewImgs.append(
      /*html*/
      "\n                        <div class=\"col-3\">\n                            <div class=\"preview-img-wrapper mb-3\">\n                                <img class=\"img-thumbnail\" src=\"".concat(fileReader.result, "\" alt=\"\">\n                            </div>\n                        </div>\n                "));
    });
    fileReader.readAsDataURL(file);
  });
}

function debounce(func) {
  var timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 200;
  var timer;
  return function () {
    var _this = this;

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    clearTimeout(timer);
    timer = setTimeout(function () {
      func.apply(_this, args);
    }, timeout);
  };
}

function addInfiniteInputListener(selector) {
  $(selector).on("keyup", debounce(function () {
    if (!$(this).val()) {
      if (!$(this).is(":last-child")) {
        $(this).next(".infinite-input").trigger("focus");
        $(this).remove();
      }
    } else if ($(this).next(".infinite-input").length == 0) {
      $(this).after($(this).clone(true).val(""));
    }
  }));
}

function addRemoveVariant2Listener(selector) {
  $(selector).on("click", function () {
    $(this).remove();
    $("#variant2").remove();
    $("#addVariant2").show();
    updateVariantsTable();
  });
}

function updateVariantsTable() {
  console.log("update");
  var variantNames = $(".variant-name").toArray();
  var variant1Values = $(".variant1-value:not(:last-child)").toArray();
  var variant2Values = $(".variant2-value:not(:last-child)").toArray();

  if (!validateVariantInfo(variantNames, variant1Values, variant2Values)) {
    $("#variantsTable").html("<tbody><tr><td class=\"text-center\">Ch\u01B0a c\xF3 ph\xE2n lo\u1EA1i</td></tr></tbody>");
    return;
  }

  $("#variantsTable").html(
  /*html*/
  "\n        <thead>\n            <tr>\n                ".concat(variantNames.map(function (name) {
    return "<th style='text-align:center'>" + name.value + "</th>";
  }).join(""), "\n                <th style='width: 10%; text-align:center'>Gi\xE1</th>\n                <th style='width: 10%; text-align:center'>Gi\xE1 sale</th>\n                <th style='width: 10%; text-align:center'>SL</th>\n                <th style='width: 20%; text-align:center'>SKU</th>\n                <th style='width: 6%; text-align:center'>\u1EA2nh</th>\n                <th style='width: 0%; text-align:center'></th>\n            </tr>\n        </thead>\n        <tbody>\n        </tbody>\n    "));
  if (variant1Values.length > 0 && variantNames.length > 0) for (var i = 0; i < variant1Values.length; i++) {
    if (variant2Values.length > 0 && variantNames.length == 2) {
      for (var j = 0; j < variant2Values.length; j++) {
        $("#variantsTable tbody").append(
        /*html*/
        "\n                        <tr>\n                            <td style=\"font-weight: bold;\">".concat(variant1Values[i].value, "</td>\n                            <td style=\"font-weight: bold;\">").concat(variant2Values[j].value, "</td>\n                            <td><input type=\"text\" class=\"form-control v-price\" name=\"v_prices[").concat(i, "][").concat(j, "\" id=\"\"></td>\n                            <td><input type=\"text\" class=\"form-control v-sale-price\" name=\"v_sale_prices[").concat(i, "][").concat(j, "]\" id=\"\"></td>\n                            <td><input type=\"text\" class=\"form-control v-quantity\" name=\"v_quantities[").concat(i, "][").concat(j, "]\" id=\"\"></td>\n                            <td><input type=\"text\" class=\"form-control v-sku\" name=\"v_skus[").concat(i, "][").concat(j, "]\" id=\"\"></td>\n                            <td>\n                                <div>\n                                    <input type=\"file\" class=\"form-control d-none v-image\" id=\"vImage[").concat(i, "][").concat(j, "]\" name=\"v_images[").concat(i, "][").concat(j, "]\">\n                                    <label class=\"d-block required preview-img-wrapper img-thumbnail\" for=\"vImage[").concat(i, "][").concat(j, "]\">\n                                        <img src=\"/storage/images/logo.png\" alt=\"\" class=\"preview-variant img-fluid\">\n                                    </label>\n                                </div>\n                            </td>\n                            <td class=\"text-center\"><button type=\"button\" class=\"btn btn-danger delete-row-btn\">Xo\xE1</button></td>\n                        </tr>\n                    "));
      }
    } else {
      if (variant1Values[i].value.length > 0) {
        $("#variantsTable tbody").append(
        /*html*/
        "\n                        <tr>\n                            <td style=\"font-weight: bold;\">".concat(variant1Values[i].value, "</td>\n                            <td><input type=\"text\" class=\"form-control v-price\" name=\"v_price[").concat(i, "]\" id=\"\"></td>\n                            <td><input type=\"text\" class=\"form-control v-sale-price\" name=\"v_sale_prices[").concat(i, "]\" id=\"\"></td>\n                            <td><input type=\"text\" class=\"form-control v-quantity\" name=\"v_quantity[").concat(i, "]\" id=\"\"></td>\n                            <td><input type=\"text\" class=\"form-control v-sku\" name=\"v_sku[").concat(i, "]\" id=\"\"></td>\n                            <td>\n                                <div>\n                                    <input type=\"file\" class=\"form-control d-none v-image\" id=\"vImage[").concat(i, "]\" name=\"v_images[").concat(i, "]\">\n                                    <label class=\"d-block required preview-img-wrapper img-thumbnail\" for=\"vImage[").concat(i, "]\">\n                                        <img src=\"/storage/images/logo.png\" alt=\"\" class=\"preview-variant img-fluid\">\n                                    </label>\n                                </div>\n                            </td>\n                            <td class=\"text-center\"><button type=\"button\" class=\"btn btn-danger delete-row-btn\">Xo\xE1</button></td>\n                        </tr>\n                    "));
      }
    }
  }
  addRemoveRowEventListener();
  addVariantImagePreviewListener();
}

function addUpdateTableListener() {
  $(".variant-group input.form-control").on("keyup", debounce(updateVariantsTable, 500));
}

function validateVariantInfo(_ref, v1, v2) {
  var _ref2 = _slicedToArray(_ref, 2),
      n1 = _ref2[0],
      n2 = _ref2[1];

  if (!n1.value || v1.length == 0 || n2 !== null && n2 !== void 0 && n2.value && v2.length == 0 || v2.length > 0 && !(n2 !== null && n2 !== void 0 && n2.value)) {
    return false;
  } else return true;
}

function addVariantImagePreviewListener() {
  $(".v-image").on("change", function () {
    previewImage(this);
  });
}

function addRemoveRowEventListener() {
  $(".delete-row-btn").on("click", function () {
    $(this).parents("tr").remove();

    if ($("#variantsTable tbody tr").length === 0) {
      $("#variantsTable").html("<tbody><tr><td class=\"text-center\">Ch\u01B0a c\xF3 ph\xE2n lo\u1EA1i</td></tr></tbody>");
    }
  });
}
/******/ })()
;